<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="initial-scale=1, width=device-width">
	<title>Confirm Booking Page</title>

	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap" rel="stylesheet">

	<style>
		#map {
		  height: 80%;
		}
		html, body, p, hr {
		  margin: 0;
		  padding: 0;
		}
		html, body {
		  height: 100%;
		}
	</style>
</head>
<body>
	<div id="map"></div>
	<script>
		function initMap() {
      var mapOpt = {
        zoom: 14,
        center: {lat:42.3601, lng:-71.0589}, // Default map center is Boston
        mapTypeControl: false
      };

      var map = new google.maps.Map(document.getElementById('map'), mapOpt);

      var directionsDisplay = new google.maps.DirectionsRenderer();

      var directionsService = new google.maps.DirectionsService();

      directionsDisplay.setMap(map);

      // Create map markers with the following function
      function addMarker(markerOpt) {
        var userPositionMarker = new google.maps.Marker({
          position: markerOpt.coords,
          map: map
        });

        if (markerOpt.imgUrl) {
          userPositionMarker.setIcon(markerOpt.imgUrl);
        }

        if (markerOpt.goToUrl) {
          google.maps.event.addListener(userPositionMarker, "click", () => {
            window.location.href = markerOpt.goToUrl;
          });
        }
      }

      // Set map center to user's position
      function success(position) {
        var uLatLng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
        map.setCenter(uLatLng);

        // Set coord for randomly generated photographer
        let x = 0.01 * Math.random(),
          y = 0.01 * Math.random();

        x = position.coords.latitude + ((Math.random() > 0.5) ? x : (-1 * x));
        y = position.coords.longitude + ((Math.random() > 0.5) ? y : (-1 * y));

        var pLatLng = new google.maps.LatLng(x, y);

        function calculateRoute() {
        	var request = {
        		origin: uLatLng,
        		destination: pLatLng,
        		travelMode: 'WALKING'
        	};

        	directionsService.route(request, (results, status) => {
        		if (status == "OK") {
        			directionsDisplay.setDirections(results);
        		}
        	});

        }

        calculateRoute();
      }

      function error() {
        console.log("Unable to retrieve your location");
      }

      if (!navigator.geolocation) {
        console.log("Geolocation is not supported by the browser");
      } else {
        navigator.geolocation.getCurrentPosition(success, error);
      }
    }
	</script>
	<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBcKboMTJqDScCPtvpLh5CwvCTi4xkitp8&callback=initMap"></script>
</body>
</html>